<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Notes | Guiding Principles for tidymodels Packages</title>
  <meta name="description" content="Chapter 9 Notes | Guiding Principles for tidymodels Packages" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Notes | Guiding Principles for tidymodels Packages" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Notes | Guiding Principles for tidymodels Packages" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="parallel-processing.html"/>

<script src="libs/header-attrs-2.1/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="general-conventions.html"><a href="general-conventions.html"><i class="fa fa-check"></i><b>2</b> General Conventions</a></li>
<li class="chapter" data-level="3" data-path="function-interfaces.html"><a href="function-interfaces.html"><i class="fa fa-check"></i><b>3</b> Function Interfaces</a>
<ul>
<li class="chapter" data-level="3.1" data-path="function-interfaces.html"><a href="function-interfaces.html#user-facing-functions"><i class="fa fa-check"></i><b>3.1</b> User-Facing Functions</a></li>
<li class="chapter" data-level="3.2" data-path="function-interfaces.html"><a href="function-interfaces.html#computational-functions"><i class="fa fa-check"></i><b>3.2</b> Computational Functions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="the-model-object.html"><a href="the-model-object.html"><i class="fa fa-check"></i><b>4</b> The Model Object</a></li>
<li class="chapter" data-level="5" data-path="print-and-summary-methods.html"><a href="print-and-summary-methods.html"><i class="fa fa-check"></i><b>5</b> Print and Summary Methods</a></li>
<li class="chapter" data-level="6" data-path="model-predictions.html"><a href="model-predictions.html"><i class="fa fa-check"></i><b>6</b> Model Predictions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="model-predictions.html"><a href="model-predictions.html#input-data"><i class="fa fa-check"></i><b>6.1</b> Input Data</a></li>
<li class="chapter" data-level="6.2" data-path="model-predictions.html"><a href="model-predictions.html#return-values"><i class="fa fa-check"></i><b>6.2</b> Return Values</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="argument-names.html"><a href="argument-names.html"><i class="fa fa-check"></i><b>7</b> Argument Names</a>
<ul>
<li class="chapter" data-level="7.1" data-path="argument-names.html"><a href="argument-names.html#dot-usage"><i class="fa fa-check"></i><b>7.1</b> Dot Usage</a></li>
<li class="chapter" data-level="7.2" data-path="argument-names.html"><a href="argument-names.html#standardization-of-arguments"><i class="fa fa-check"></i><b>7.2</b> Standardization of Arguments</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="argument-names.html"><a href="argument-names.html#data-arguments"><i class="fa fa-check"></i><b>7.2.1</b> Data Arguments</a></li>
<li class="chapter" data-level="7.2.2" data-path="argument-names.html"><a href="argument-names.html#numerical-arguments"><i class="fa fa-check"></i><b>7.2.2</b> Numerical Arguments</a></li>
<li class="chapter" data-level="7.2.3" data-path="argument-names.html"><a href="argument-names.html#statistical-quantities"><i class="fa fa-check"></i><b>7.2.3</b> Statistical Quantities</a></li>
<li class="chapter" data-level="7.2.4" data-path="argument-names.html"><a href="argument-names.html#tuning-parameters"><i class="fa fa-check"></i><b>7.2.4</b> Tuning Parameters</a></li>
<li class="chapter" data-level="7.2.5" data-path="argument-names.html"><a href="argument-names.html#others"><i class="fa fa-check"></i><b>7.2.5</b> Others</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>8</b> Parallel Processing</a></li>
<li class="chapter" data-level="9" data-path="notes.html"><a href="notes.html"><i class="fa fa-check"></i><b>9</b> Notes</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Guiding Principles for tidymodels Packages</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="notes" class="section level1" number="9">
<h1><span class="header-section-number">Chapter 9</span> Notes</h1>
<div id="messages">

</div>
<p><strong><em>writing output</em></strong></p>
<p>To write messages, <code>cat()</code> or <code>message()</code> can be used. Their differences:</p>
<ul>
<li><p><code>cat()</code> goes to standard out and <code>message()</code> goes to standard error. When used inside of <em>some</em> parallel processing backends, <code>cat()</code> output is obscured inside of the RStudio IDE.</p></li>
<li><p>Unless coded otherwise, <code>cat()</code> uses the usual formatting whereas the default formatting for <code>message()</code> is different.</p></li>
</ul>
<p>For this code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="notes.html#cb1-1"></a><span class="kw">library</span>(emojifont)</span>
<span id="cb1-2"><a href="notes.html#cb1-2"></a><span class="kw">message</span>(<span class="st">&quot;Help! I&#39;m trapped in the well!!&quot;</span>)</span>
<span id="cb1-3"><a href="notes.html#cb1-3"></a><span class="kw">cat</span>(<span class="st">&quot;No, you&#39;re not&quot;</span>, <span class="kw">emoji</span>(<span class="st">&#39;roll_eyes&#39;</span>), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<p>the Rstudio IDE output is:</p>
<p><img src="ide_formatting.png" width="50%" style="display: block; margin: auto;" /></p>
<p>and basic terminal output is:</p>
<p><img src="console_formatting.png" width="50%" style="display: block; margin: auto;" /></p>
<p><a href="https://www.jstorimer.com/blogs/workingwithcode/7766119-when-to-use-stderr-instead-of-stdout">This post</a> may also be helpful in deciding.</p>
<p><a href="general-conventions.html#messages-back">↩︎️</a></p>
<p><strong><em>decoupling functions</em></strong></p>
<div id="decouple">

</div>
<p>For example, for some modeling method, the function <code>foo</code> would be the top-level api that users experience and some other function (say <code>compute_foo_fit</code>) is used to do the computations. This allows for different interfaces to be used to specify the model that pass common data structures to <code>compute_foo_fit</code>.</p>
<p><a href="function-interfaces.html#decouple-back">↩︎️</a></p>
<p><strong><em>appropriate data structures</em></strong></p>
<div id="user-appropriate">

</div>
<p>For example:</p>
<ul>
<li>Categorical data should be in factor variables (as opposed to binary or integer representations).</li>
<li>Rectangular data structures that allows for mixed data types should <em>always</em> be used even when the envisioned application would only make sense when the data are single type.</li>
<li>For strictly univariate response models, vector input is acceptable for the outcome argument.</li>
<li>Censored data should follow the <code>survival::Surv</code> convention.</li>
</ul>
<p><a href="function-interfaces.html#user-appropriate-back">↩︎️</a></p>
<p><strong><em>top-level design examples</em></strong></p>
<div id="top-level">

</div>
<p>For example:</p>
<ul>
<li><p>Suppose a model can only fit numeric or two-class outcomes and uses maximum likelihood. Instead of providing the user with a <code>distribution</code> option that is either “Gaussian” or “Binomial”, determine this from the type of the data object (numeric or factor) and set internally. This prevents the user from making a mistake that could haven been avoided.</p></li>
<li><p>If a model parameter is bounded by some aspect of the data, such as the number of rows or columns, coerce bad values to this range (e.g. <code>mtry = min(mtry, ncol(x))</code>) with an accompanying warning when this is critical information.</p></li>
</ul>
<p><a href="function-interfaces.html#top-level-back">↩︎️</a></p>
<p><strong><em>avoid common parameter names</em></strong></p>
<div id="common-param">

</div>
<p>For example, <code>control</code> is the type of argument used in many functions so have a function specific argument (e.g. <code>foo_control</code>) is advisable in these situations.</p>
<p><a href="function-interfaces.html#common-param-back">↩︎️</a></p>
<p><strong><em>Checking of <code>...</code></em></strong></p>
<div id="dot-check">

</div>
<p>The <a href="https://github.com/hadley/ellipsis"><code>conflicted</code></a> package can be used to solve this issue.</p>
<p><a href="function-interfaces.html#dot-check-back">↩︎️</a></p>
<p><strong><em>standardize names</em></strong></p>
<div id="standardized">

</div>
<p>For example, many functions use some variation of <code>level</code> for confidence levels (as opposed to <code>alpha</code>). The names in Chapter <a href="argument-names.html#argument-names">7</a> are preferable for the specific context.</p>
<p><a href="function-interfaces.html#standardized-back">↩︎️</a></p>
<p><strong><em>design function names for tab-complete</em></strong></p>
<p>For example, the tune package has <code>control</code> arguments for different functions. The function <em>functions</em> that generate the appropriate lists are named with suffixes that indicate where they are used: <code>control_grid()</code>, <code>control_bayes()</code>, <code>control_resamples()</code>, and so on.</p>
<p><a href="argument-names.html#argument-names">↩︎️</a></p>
<p><strong><em>discussing new names</em></strong></p>
<div id="discuss">

</div>
<p>A good venue for this discussion is <a href="https://community.rstudio.com/">RStudio Community</a></p>
<p><a href="model-predictions.html#discuss-back">↩︎️</a></p>
<p><strong><em>avoid computing on <code>call</code> objects</em></strong></p>
<div id="calls">

</div>
<p>Historically, the call object that results from a model fit was considered a good method to capture details of the existing model fit. This object could be parsed and manipulated for the purpose of continuing or revising the model <em>between function calls</em>.</p>
<p>This can be problematic because the call object is relative to the environment and the call itself is agnostic to its original environment. If the call is changed and re-evaluated, the current environment may be inappropriate. This could result in errors due to the required objects not being exposed in the current environment.</p>
<p>Note that the internals of common modeling functions, such as <code>lm</code>, do exactly this. However, these manipulations occur <em>within</em> the function call so that the environment is the same.</p>
<p><a href="function-interfaces.html#calls-back">↩︎️</a></p>
<p><strong><em>minimal object retention</em></strong></p>
<div id="minimal">

</div>
<p>For example, if summary statistics are computed on the model object, derive them on-the-fly during the execution of the <code>summary</code> method. Avoid saving these statistics to the model object unless they are related to ephemeral values generated during the model fit but do not need to be retained afterwards.</p>
<p><a href="the-model-object.html#minimal-back">↩︎️</a></p>
<p><strong><em>consistent number of rows</em></strong></p>
<div id="binding">

</div>
<p>This should enable the ability to bind the results with the original data:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="notes.html#cb2-1"></a><span class="kw">cbind</span>(data, <span class="kw">predict</span>(model, data)) <span class="co"># or</span></span>
<span id="cb2-2"><a href="notes.html#cb2-2"></a><span class="kw">predict</span>(model, data) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(data)</span></code></pre></div>
<p><a href="model-predictions.html#dplyr-like-back">↩︎️</a></p>
<p><strong><em>extra tibble classes</em></strong></p>
<div id="dplyr-like">

</div>
<p>Adding a new class to a tibble object might cause subsequent errors to <code>dplyr</code> operations. <a href="https://github.com/tidyverse/googledrive/blob/master/R/dplyr-compat.R">This code</a> is a good example for how to maintain <code>dplyr</code> compatibility.</p>
<p><a href="model-predictions.html#dplyr-like-back">↩︎️</a></p>
<p><strong><em>list column output</em></strong></p>
<div id="list-cols">

</div>
<p>Some examples:</p>
<p><strong>posterior distirbutions</strong></p>
<p>If a posterior distribution is returned for each sample, each element of the list column can be a tibble with as many rows as samples in the distribution.</p>
<p><strong>multiple hyperparameters</strong></p>
<p>When a <code>predict</code> method produces values over multiple tuning parameter values (e.g. <code>glmnet</code>), the list column elements have rows for every tuning parameter value combination that is being changed (e.g. <code>lambda</code> in <code>glmnet</code>).</p>
<p><strong>survivor probability predictions</strong></p>
<p>In time to event models, where survivor probabilities are produced for values of <code>time</code>, the return tibble has a column for <code>.time</code>. Other column names should conform to the standards here (e.g. <code>.pred_lower</code> if intervals are also returned). As an example from <code>?flexsurv::flexsurvreg</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="notes.html#cb3-1"></a><span class="kw">library</span>(flexsurv)</span>
<span id="cb3-2"><a href="notes.html#cb3-2"></a><span class="kw">data</span>(ovarian)</span>
<span id="cb3-3"><a href="notes.html#cb3-3"></a>fitg &lt;-<span class="st"> </span><span class="kw">flexsurvreg</span>(<span class="dt">formula =</span> <span class="kw">Surv</span>(futime, fustat) <span class="op">~</span><span class="st"> </span>age, <span class="dt">data =</span> ovarian, <span class="dt">dist =</span> <span class="st">&quot;gengamma&quot;</span>)</span></code></pre></div>
<p>For each new sample, this model can make probabilistic predictions at a number of user-specified time points.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="notes.html#cb4-1"></a>preds &lt;-<span class="st"> </span><span class="kw">summary</span>(fitg, <span class="dt">newdata =</span> ovarian[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="st">&quot;age&quot;</span>, <span class="dt">drop =</span> <span class="ot">FALSE</span>], <span class="dt">t =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>))</span>
<span id="cb4-2"><a href="notes.html#cb4-2"></a>preds</span></code></pre></div>
<pre><code>## age=72.3315 
##   time       est        lcl       ucl
## 1  100 0.7988680 0.51091386 0.9648924
## 2  200 0.4849180 0.15909221 0.7913010
## 3  300 0.2784226 0.02375807 0.6402882
## 
## age=74.4932 
##   time       est          lcl       ucl
## 1  100 0.7278338 0.3557049000 0.9594533
## 2  200 0.3856737 0.0408961893 0.7646142
## 3  300 0.1964611 0.0003635201 0.6010698</code></pre>
<p>A list of data frames is not very helpful. Better would be a data frame with a list column, where every element is a data frame with the predictions in the tidy format:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="notes.html#cb6-1"></a>tidy_preds</span></code></pre></div>
<pre><code>## # A tibble: 2 x 1
##   .pred           
##   &lt;named list&gt;    
## 1 &lt;tibble [3 × 4]&gt;
## 2 &lt;tibble [3 × 4]&gt;</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="notes.html#cb8-1"></a><span class="co"># predictions on the first subject at 3 time points</span></span>
<span id="cb8-2"><a href="notes.html#cb8-2"></a>tidy_preds<span class="op">$</span>.pred[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   .time .pred .pred_lower .pred_upper
##   &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1   100 0.799      0.511        0.965
## 2   200 0.485      0.159        0.791
## 3   300 0.278      0.0238       0.640</code></pre>
<p>If a single data frame is needed, it is easy to make the conversion:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="notes.html#cb10-1"></a>tidyr<span class="op">::</span><span class="kw">unnest</span>(tidy_preds)</span></code></pre></div>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(.pred)`</code></pre>
<pre><code>## # A tibble: 6 x 4
##   .time .pred .pred_lower .pred_upper
##   &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1   100 0.799    0.511          0.965
## 2   200 0.485    0.159          0.791
## 3   300 0.278    0.0238         0.640
## 4   100 0.728    0.356          0.959
## 5   200 0.386    0.0409         0.765
## 6   300 0.196    0.000364       0.601</code></pre>
<p><strong>quantile predictions</strong></p>
<p>When using a quantile regression, one might make the median the default that is predicted. If multiple percentiles are requested, then <code>.pred</code> would be a tibble with a column for the predictions and another for the quantile (named <code>.quantile</code>).</p>
<p><a href="model-predictions.html#list-cols-back">↩︎️</a></p>
<p><strong><em>where to parallelize?</em></strong></p>
<div id="par-long">

</div>
<p>For example, if a random forest model is being created the parallelism could simultaneously fit the trees in the ensemble or parallelize the search for optimal splits <em>within</em> each tree. All other things being equal, the former is preferred.</p>
<p><a href="#par-seed-long">↩︎️</a></p>
<p><strong><em>controlling random numbers in parallel workers</em></strong></p>
<div id="par-seed">

</div>
<p>One simple approach when parallelism is conducted using R subprocesses (e.g. via <code>foreach</code> or <code>futures</code>) is to <em>pre-compute</em> seeds and have a seed argument to the function being invoked. The function can immediately set the seed from the argument when it begins execution.</p>
<p><a href="parallel-processing.html#par-seed-back">↩︎️</a></p>
<p><strong><em>predictions shouldn’t depend on <code>new_data</code></em></strong></p>
<div id="splines-trap">

</div>
<p>Sometimes spline expansions or similar terms can behave oddly when packages haven’t been fully loaded. For example:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="notes.html#cb13-1"></a>fit &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>disp <span class="op">+</span><span class="st"> </span>hp <span class="op">+</span><span class="st"> </span>splines<span class="op">::</span><span class="kw">ns</span>(drat, <span class="dv">2</span>), mtcars)</span>
<span id="cb13-2"><a href="notes.html#cb13-2"></a></span>
<span id="cb13-3"><a href="notes.html#cb13-3"></a>hp &lt;-<span class="st"> </span><span class="kw">head</span>(<span class="kw">predict</span>(fit, mtcars))</span>
<span id="cb13-4"><a href="notes.html#cb13-4"></a>ph &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, <span class="kw">head</span>(mtcars))</span>
<span id="cb13-5"><a href="notes.html#cb13-5"></a></span>
<span id="cb13-6"><a href="notes.html#cb13-6"></a><span class="kw">all.equal</span>(hp, ph)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Loading the <code>splines</code> package fixes this:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="notes.html#cb15-1"></a><span class="kw">library</span>(splines)</span>
<span id="cb15-2"><a href="notes.html#cb15-2"></a>fit &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>disp <span class="op">+</span><span class="st"> </span>hp <span class="op">+</span><span class="st"> </span><span class="kw">ns</span>(drat, <span class="dv">2</span>), mtcars)</span>
<span id="cb15-3"><a href="notes.html#cb15-3"></a></span>
<span id="cb15-4"><a href="notes.html#cb15-4"></a>hp &lt;-<span class="st"> </span><span class="kw">head</span>(<span class="kw">predict</span>(fit, mtcars))</span>
<span id="cb15-5"><a href="notes.html#cb15-5"></a>ph &lt;-<span class="st"> </span><span class="kw">predict</span>(fit, <span class="kw">head</span>(mtcars))</span>
<span id="cb15-6"><a href="notes.html#cb15-6"></a></span>
<span id="cb15-7"><a href="notes.html#cb15-7"></a><span class="kw">all.equal</span>(hp, ph)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>A general way to check for errors like this is to check that <code>predict()</code> and <code>head()</code> commute.</p>
<p><a href="model-predictions.html#splines-trap-back">↩︎️</a></p>
<p><strong><em>models should have meaningful classes</em></strong></p>
<p>This makes it easier to provide methods that might be meaningfully defined for only some models accessible via the convenience interface. For example, consider generalized linear models. It makes sense to define hard class predictions for logistic regression, but not linear regression. It is easiest to define prediction methods specific to linear and logistic regression if each is represented by an R object with different classes.</p>
<p><a href="the-model-object.html#subclasses-back">↩︎️</a></p>
<p><strong><em>design function names for tab-complete</em></strong></p>
<p>For example, the tune package has <code>control</code> arguments for different functions. The function <em>functions</em> that generate the appropriate lists are named with suffixes that indicate where they are used: <code>control_grid()</code>, <code>control_bayes()</code>, <code>control_resamples()</code>, and so on.</p>
<p><a href="argument-names.html#argument-names">↩︎️</a></p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="parallel-processing.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/tidymodels/model-implementation-principles/edit/master/08-notes.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
