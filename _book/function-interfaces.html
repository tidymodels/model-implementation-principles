<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Conventions for R Modeling Packages</title>
  <meta name="description" content="Conventions for R Modeling Packages">
  <meta name="generator" content="bookdown 0.7.11 and GitBook 2.6.7">

  <meta property="og:title" content="Conventions for R Modeling Packages" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Conventions for R Modeling Packages" />
  
  
  



<meta name="date" content="2018-09-12">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="general-conventions.html">
<link rel="next" href="the-model-object.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="general-conventions.html"><a href="general-conventions.html"><i class="fa fa-check"></i><b>2</b> General Conventions</a></li>
<li class="chapter" data-level="3" data-path="function-interfaces.html"><a href="function-interfaces.html"><i class="fa fa-check"></i><b>3</b> Function Interfaces</a><ul>
<li class="chapter" data-level="3.1" data-path="function-interfaces.html"><a href="function-interfaces.html#user-facing-functions"><i class="fa fa-check"></i><b>3.1</b> User-Facing Functions</a></li>
<li class="chapter" data-level="3.2" data-path="function-interfaces.html"><a href="function-interfaces.html#computational-functions"><i class="fa fa-check"></i><b>3.2</b> Computational Functions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="the-model-object.html"><a href="the-model-object.html"><i class="fa fa-check"></i><b>4</b> The Model Object</a></li>
<li class="chapter" data-level="5" data-path="print-and-summary-methods.html"><a href="print-and-summary-methods.html"><i class="fa fa-check"></i><b>5</b> Print and Summary Methods</a></li>
<li class="chapter" data-level="6" data-path="model-predictions.html"><a href="model-predictions.html"><i class="fa fa-check"></i><b>6</b> Model Predictions</a><ul>
<li class="chapter" data-level="6.1" data-path="model-predictions.html"><a href="model-predictions.html#input-data"><i class="fa fa-check"></i><b>6.1</b> Input Data</a></li>
<li class="chapter" data-level="6.2" data-path="model-predictions.html"><a href="model-predictions.html#return-values"><i class="fa fa-check"></i><b>6.2</b> Return Values</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="standardized-argument-names.html"><a href="standardized-argument-names.html"><i class="fa fa-check"></i><b>7</b> Standardized Argument Names</a><ul>
<li class="chapter" data-level="7.1" data-path="standardized-argument-names.html"><a href="standardized-argument-names.html#data-arguments"><i class="fa fa-check"></i><b>7.1</b> Data Arguments</a></li>
<li class="chapter" data-level="7.2" data-path="standardized-argument-names.html"><a href="standardized-argument-names.html#numerical-arguments"><i class="fa fa-check"></i><b>7.2</b> Numerical Arguments</a></li>
<li class="chapter" data-level="7.3" data-path="standardized-argument-names.html"><a href="standardized-argument-names.html#statistical-quantities"><i class="fa fa-check"></i><b>7.3</b> Statistical Quantities</a></li>
<li class="chapter" data-level="7.4" data-path="standardized-argument-names.html"><a href="standardized-argument-names.html#tuning-parameters"><i class="fa fa-check"></i><b>7.4</b> Tuning Parameters</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="parallel-processing.html"><a href="parallel-processing.html"><i class="fa fa-check"></i><b>8</b> Parallel Processing</a></li>
<li class="chapter" data-level="9" data-path="notes.html"><a href="notes.html"><i class="fa fa-check"></i><b>9</b> Notes</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Conventions for R Modeling Packages</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="function-interfaces" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Function Interfaces</h1>
<p>We distinguish between “top-level”/“user-facing” api’s and “low-level”/“computational” api’s. The former being the interface between the users of the function (with their needs) and the code that does the estimation/training activities.</p>
<div id="decouple-back">

</div>
<p>When creating model objects, the computational code that fits the model should be <strong>decoupled</strong> from the interface code to specify the model. This allows for different interfaces to be used to specify the model that then pass common data structures on to
the computational code. <a href="notes.html#decouple">{note}</a></p>
<div id="user-facing-functions" class="section level2">
<h2><span class="header-section-number">3.1</span> User-Facing Functions</h2>
<ul>
<li>At a minimum, the top-level model function should be a generic with methods for data frames, formulas, and possibly recipes. These methods error trap bad arguments, format/encode the data, them pass it along to the lower-level computational code. <a href="notes.html#generic-functions">{note}</a></li>
</ul>
<div id="generic-functions-back">

</div>
<ul>
<li><p>Do not require users to create dummy variables from their categorical predictors. Provide a formula and/or recipe interface to your model to do this (see the next item) and other methods should error trap if qualitative data should not be subsequently used.</p></li>
<li><p>These top-level functions should use proper S3 dispatch (e.g. appropriately invoke to <code>foo.data.frame</code>, <code>foo.formula</code> and so on).</p></li>
</ul>
<div id="user-appropriate-back">

</div>
<ul>
<li>Only <strong>user-appropriate data structures</strong> should be accommodated for the user-facing function. The underlying computational code should make appropriate transformations to computationally appropriate formats/encodings. <a href="notes.html#user-appropriate">{note}</a></li>
</ul>
<div id="top-level-back">

</div>
<ul>
<li><p><strong>Design the top-level code for humans</strong>. This includes using sensible defaults and protecting against common errors. Design your top-level interface code so that people will not hate you. <a href="notes.html#top-level">{note}</a></p></li>
<li><p>Parameters that users will commonly modify should be main arguments to the top-level function. Others, especially those that control computational aspects of the fit, should be contained in a <code>control</code> object.</p></li>
</ul>
<div id="common-param-back">

</div>
<ul>
<li>If your model passes <code>...</code> to another modeling function, consider the names of your top-level function arguments to avoid conflicts with the argument names of the underlying function. <a href="notes.html#common-param">{note}</a></li>
</ul>
<div id="dot-check-back">

</div>
<ul>
<li>If possible, check to see if the arguments passed to <code>...</code> are real arguments to the function(s) receiving the <code>...</code>. <a href="notes.html#dot-check">{note}</a></li>
</ul>
<div id="standardized-back">

</div>
<ul>
<li>Common arguments should use standardized names. <a href="notes.html#standardized">{note}</a></li>
</ul>
</div>
<div id="computational-functions" class="section level2">
<h2><span class="header-section-number">3.2</span> Computational Functions</h2>
<ul>
<li><p>A test set should never be required when fitting a model.</p></li>
<li><p>If internal resampling is involved in the fitting process, there is a strong preference for using <code>tidymodels</code> infrastructure so that a common interface (and set of choices) can be used. If this cannot be done (e.g. the resampling occurs in C code), there should be some ability to pass in integer values that define the resamples. In this way, the internal sampling is reproducible. The same is true for other infrastructure (e.g. <code>yardstick</code> for performance measures, etc.)</p></li>
<li><p>When possible, do not reimplement computations that have been done well elsewhere (tidy or not). For example, kernel methods should use the infrastructure in <code>kernlab</code>, exponential family distribution computations should use those in <code>?family</code> etc.</p></li>
<li><p>For modeling packages that use random numbers, setting the seed in R should control how random numbers are generated internally. At worst, a random number seed for non-R code (e.g. C, Java) should be an argument to the main modeling function.</p></li>
<li><p>Computational code should (almost) always use <code>X[ , ,drop = FALSE]</code> when subsetting matrices (and non-tibble data frames) to make sure that the 2D structure is maintained.</p></li>
<li><p>Use <code>try</code> or similar methods to avoid an uncontrolled errors in order to return intelligible errors.</p></li>
</ul>
<div id="calls-back">

</div>
<ul>
<li>Using the call object for post-estimation activies is discouraged. <a href="notes.html#calls">{note}</a></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="general-conventions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-model-object.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
